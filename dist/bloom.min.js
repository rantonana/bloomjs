/*
 *  bloom-js - v0.0.6
 *  API Client for BloomAPI.
 *  http://www.bloomapi.com
 *
 *  Made by Michael M. Wasser
 *  Under MIT License
 */
!function(a){"use strict";function b(a,b){var c="BloomJS/0.0.5";if("undefined"!=typeof window){var e,f="_jsonp_"+d;d+=1,a+=a.match(/\?/)?"&callback="+f:"?callback="+f,e=document.createElement("script"),e.type="text/javascript",e.src=a,window[f]=function(a){b.call(window,null,a),document.getElementsByTagName("head")[0].removeChild(e),e=null,delete window[f]},document.getElementsByTagName("head")[0].appendChild(e)}else{var g,h,i=require("http"),j=require("https"),k=require("url"),l=require("zlib");g=k.parse(a),h="https:"===g.protocol?j:i,h.get({headers:{"User-Agent":c,"Accept-Encoding":"gzip,deflate"},hostname:g.hostname,port:g.port,path:g.path,agent:!1},function(a){var c=[];return 200!==a.statusCode&&304!==a.statusCode?b(new Error("Non-OK http return: "+a.statusCode)):(a.on("data",function(a){c.push(a)}),void a.on("end",function(){var d,e=Buffer.concat(c),f=a.headers["content-encoding"];if("gzip"===f)l.gunzip(e,function(a,c){var d;try{d=JSON.parse(c)}catch(e){return b(e)}b(null,d)});else if("deflate"===f)l.inflate(e,function(a,c){var d;try{d=JSON.parse(c)}catch(e){return b(e)}b(null,d)});else{var g;d=e.toString();try{g=JSON.parse(d)}catch(h){return b(h)}b(null,g)}}))}).on("error",function(a){return b(a)})}}function c(a){var b,c,d,e,f="",g=1;if(a instanceof Array)for(var h=0;h<a.length;h++){var i=a[h];for(b in i)if(f.length>0&&(f+="&"),"string"==typeof i[b])f+="key"+g+"="+b,f+="&op"+g+"=eq",f+="&value"+g+"="+i[b],g+=1;else if(i[b]instanceof Array){for(c=0,d=i[b],f+="key"+g+"="+b,f+="&op"+g+"=eq";c<d.length;c+=1)f+="&value"+g+"="+d[c];g+=1}else{if("object"!=typeof i[b]||null===typeof i[b])throw new Error("Unexpected query structure");for(e in i[b])if("string"==typeof i[b][e])f+="key"+g+"="+b,f+="&op"+g+"="+e,f+="&value"+g+"="+i[b][e],g+=1;else{if(!(i[b][e]instanceof Array))throw new Error("Unexpected query structure");for(nestOrIndex=0,nestValues=i[b][e],f+="key"+g+"="+b,f+="&op"+g+"="+e;nestOrIndex<nestValues.length;nestOrIndex+=1)f+="&value"+g+"="+nestValues[nestOrIndex];g+=1}}}else for(b in a)if(f.length>0&&(f+="&"),"string"==typeof a[b])f+="key"+g+"="+b,f+="&op"+g+"=eq",f+="&value"+g+"="+a[b],g+=1;else if(a[b]instanceof Array){for(c=0,d=a[b],f+="key"+g+"="+b,f+="&op"+g+"=eq";c<d.length;c+=1)f+="&value"+g+"="+d[c];g+=1}else{if("object"!=typeof a[b]||null===typeof a[b])throw new Error("Unexpected query structure");for(e in a[b])if("string"==typeof a[b][e])f+="key"+g+"="+b,f+="&op"+g+"="+e,f+="&value"+g+"="+a[b][e],g+=1;else{if(!(a[b][e]instanceof Array))throw new Error("Unexpected query structure");for(nestOrIndex=0,nestValues=a[b][e],f+="key"+g+"="+b,f+="&op"+g+"="+e;nestOrIndex<nestValues.length;nestOrIndex+=1)f+="&value"+g+"="+nestValues[nestOrIndex];g+=1}}return f}a.Client=function(a){this.url="http://www.bloomapi.com/api",this.defaultOptions={offset:0,limit:20},"string"==typeof a?this.apiKey=a:"object"==typeof a&&null!==a&&("undefined"!=typeof a.apiKey&&(this.apiKey=a.apiKey),"undefined"!=typeof a.url&&(this.url=a.url))},a.Client.prototype={sources:function(a){var c,d="";"undefined"!=typeof this.apiKey&&(d.length>0&&(d+="&"),d+="secret="+this.apiKey),c=this.url+"/sources"+("undefined"!=typeof d?"?"+d:""),b(c,function(b,c){return b?a(b):a(null,c.result,{meta:c.meta})})},search:function(a){var d,e,f,g={},h="";for(var i in this.defaultOptions)g[i]=this.defaultOptions[i];if("function"==typeof arguments[arguments.length-1]&&(e=arguments[arguments.length-1]),"object"==typeof arguments[1]&&null!==arguments[1]){d=arguments[1];try{h=c(d)}catch(j){return void(e&&e(j))}}if("object"==typeof arguments[2]&&null!==arguments[2]){for(var k in arguments[2])g[k]=arguments[2][k];for(var l in g)h.length>0&&(h+="&"),h+=l+"="+g[l]}"undefined"!=typeof this.apiKey&&(h.length>0&&(h+="&"),h+="secret="+this.apiKey),f=this.url+"/search/"+a+("undefined"!=typeof h?"?"+h:""),b(f,function(a,b){return a?e(a):e(null,b.result,{meta:b.meta})})},find:function(a,c,d){var e,f="";"undefined"!=typeof this.apiKey&&(f.length>0&&(f+="&"),f+="secret="+this.apiKey),e=this.url+"/sources/"+a+"/"+c+("undefined"!=typeof f?"?"+f:""),b(e,function(a,b){return a?d(a):d(null,b.result,{meta:b.meta})})}};var d=0}("undefined"==typeof exports?window.bloomjs={}:exports);