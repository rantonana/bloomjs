/*
 *  bloom-js - v0.0.2
 *  API Client for BloomAPI.
 *  http://www.bloomapi.com
 *
 *  Made by Michael M. Wasser
 *  Under MIT License
 */
!function(a){"use strict";function b(a,b){var c="BloomJS/0.0.2";if("undefined"!=typeof window){var e,f="_jsonp_"+d;d+=1,a+=a.match(/\?/)?"&callback="+f:"?callback="+f,e=document.createElement("script"),e.type="text/javascript",e.src=a,window[f]=function(a){b.call(window,null,a),document.getElementsByTagName("head")[0].removeChild(e),e=null,delete window[f]},document.getElementsByTagName("head")[0].appendChild(e)}else{var g,h,i=require("http"),j=require("https"),k=require("url");g=k.parse(a),h="https:"===g.protocol?j:i,h.get({headers:{"User-Agent":c},hostname:g.hostname,port:g.port,path:g.path},function(a){var c="";return 200!==a.statusCode&&304!==a.statusCode?b(new Error("Non-OK http return: "+a.statusCode)):(a.on("data",function(a){c+=a}),void a.on("end",function(){try{var a=JSON.parse(c);b(null,a)}catch(d){return b(d)}}))}).on("error",function(a){return b(a)})}}function c(a){var b="",c=1;for(var d in a)if(b.length>0&&(b+="&"),"string"==typeof a[d])b+="key"+c+"="+d,b+="&op"+c+"=eq",b+="&value"+c+"="+a[d],c+=1;else if(a[d]instanceof Array){var e=0,f=a[d];for(b+="key"+c+"="+d,b+="&op"+c+"=eq";e<f.length;e+=1)b+="&value"+c+"="+f[e];c+=1}else{if("object"!=typeof a[d]||null===typeof a[d])throw new Error("Unexpected query structure");for(var g in a[d])if("string"==typeof a[d][g])b+="key"+c+"="+d,b+="&op"+c+"="+g,b+="&value"+c+"="+a[d][g],c+=1;else{if(!(a[d][g]instanceof Array))throw new Error("Unexpected query structure");var h=0,i=a[d][g];for(b+="key"+c+"="+d,b+="&op"+c+"="+g;h<i.length;h+=1)b+="&value"+c+"="+i[h];c+=1}}return b}a.Client=function(a){this.url="http://www.bloomapi.com/api",this.defaultOptions={offset:0,limit:20},"string"==typeof a?this.apiKey=a:"object"==typeof a&&null!==a&&("undefined"!=typeof a.apiKey&&(this.apiKey=a.apiKey),"undefined"!=typeof a.url&&(this.url=a.url))},a.Client.prototype={sources:function(a){var c,d="";"undefined"!=typeof this.apiKey&&(d.length>0&&(d+="&"),d+="secret="+this.apiKey),c=this.url+"/sources"+("undefined"!=typeof d?"?"+d:""),b(c,function(b,c){return b?a(b):a(null,c.result,{meta:c.meta})})},search:function(a){var d,e,f,g={},h="";for(var i in this.defaultOptions)g[i]=this.defaultOptions[i];if("function"==typeof arguments[arguments.length-1]&&(e=arguments[arguments.length-1]),"object"==typeof arguments[1]&&null!==arguments[1]){d=arguments[1];try{h=c(d)}catch(j){return void(e&&e(j))}}if("object"==typeof arguments[2]&&null!==arguments[2]){for(var k in arguments[2])g[k]=arguments[2][k];for(var l in g)h.length>0&&(h+="&"),h+=l+"="+g[l]}"undefined"!=typeof this.apiKey&&(h.length>0&&(h+="&"),h+="secret="+this.apiKey),f=this.url+"/search/"+a+("undefined"!=typeof h?"?"+h:""),b(f,function(a,b){return a?e(a):e(null,b.result,{meta:b.meta})})},find:function(a,c,d){var e,f="";"undefined"!=typeof this.apiKey&&(f.length>0&&(f+="&"),f+="secret="+this.apiKey),e=this.url+"/sources/"+a+"/"+c+("undefined"!=typeof f?"?"+f:""),b(e,function(a,b){return a?d(a):d(null,b.result,{meta:b.meta})})}};var d=0}("undefined"==typeof exports?window.bloomjs={}:exports);